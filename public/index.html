<!DOCTYPE html>
<html>
<head>
  <title>ğŸŠ Tangerine</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<!-- Login -->
<div id="loginBox">
  <h2>ğŸŠ Tangerine</h2>
  <input id="usernameInput" placeholder="Your name..." />
  <button onclick="join()">Join</button>
</div>

<!-- Chat -->
<div id="chatBox" style="display:none;">
  <h2>ğŸŠ Tangerine</h2>

  <div id="chat"></div>
  <p id="typing"></p>

  <div id="inputArea">
    <!-- â¬‡ï¸ CHANGED TO TEXTAREA -->
    <textarea
      id="msg"
      placeholder="Type a message..."
      rows="2"
      oninput="typing()"
      onkeydown="handleKey(event)"
    ></textarea>

    <button onclick="send()">Send</button>
  </div>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  let username = "";
  let typingTimeout;

  const chat = document.getElementById("chat");
  const typingEl = document.getElementById("typing");

  function join() {
    username = usernameInput.value.trim();
    if (!username) return;

    loginBox.style.display = "none";
    chatBox.style.display = "block";
  }

  socket.on("message", data => {
    addMessage(data);
  });

  socket.on("chatHistory", history => {
    history.forEach(addMessage);
    chat.scrollTop = chat.scrollHeight;
  });

  function addMessage(data) {
    const div = document.createElement("div");
    div.className = "bubble " + (data.username === username ? "me" : "them");

    /* â¬‡ï¸ FIX: preserve line breaks */
    div.innerHTML = `
      <strong>${data.username}</strong><br>
      <span class="text">${data.message}</span>
    `;

    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
  }

  function send() {
    if (!msg.value.trim()) return;

    socket.emit("message", {
      username,
      message: msg.value
    });

    socket.emit("stopTyping");
    msg.value = "";
  }

  /* â¬‡ï¸ ENTER TO SEND */
  function handleKey(e) {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      send();
    }
  }

  function typing() {
    socket.emit("typing", username);

    clearTimeout(typingTimeout);
    typingTimeout = setTimeout(() => {
      socket.emit("stopTyping");
    }, 1000);
  }

  socket.on("typing", user => {
    typingEl.textContent = `${user} is typing...`;
  });

  socket.on("stopTyping", () => {
    typingEl.textContent = "";
  });
</script>

</body>
</html>
